<!DOCTYPE html>
<!-- saved from url=(0076)https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	
	<link rel="preconnect" href="https://www.google-analytics.com/">

	<link rel="preconnect" href="https://www.codeproject.com/">


	<link rel="preload" href="./Query Excel or CSV files with T-SQL- CodeProject_files/logo250x135.gif" as="image">


	<link rel="preload" href="./Query Excel or CSV files with T-SQL- CodeProject_files/logo135-bg.gif" as="image">
	<link rel="preload" href="./Query Excel or CSV files with T-SQL- CodeProject_files/jquery-3.4.1.min.js.download" as="script" type="text/javascript">


	<title>Query Excel or CSV files with T-SQL- CodeProject</title> 
    
	<link type="text/css" rel="stylesheet" href="./Query Excel or CSV files with T-SQL- CodeProject_files/Article.min.css">


    <script type="text/javascript" async="" src="./Query Excel or CSV files with T-SQL- CodeProject_files/analytics.js.download"></script><script type="text/javascript" src="./Query Excel or CSV files with T-SQL- CodeProject_files/jquery-3.4.1.min.js.download" defer=""></script>
<script type="text/javascript" src="./Query Excel or CSV files with T-SQL- CodeProject_files/article.min.js.download" defer=""></script>

	
<meta http-equiv="content-language" content="en-US">

<meta name="Description" content="Query Excel or CSV files with T-SQL without importing them in a table first">
<meta name="Keywords" content="SQL, SQL-Server, Intermediate, CSV, SSMS, ini">
<meta name="Author" content="Federico Di Marco">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">



<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="10/23/2023 9:26:00 AM">
<meta property="article:modified_time" content="6/19/2024 2:26:00 PM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Federico Di Marco">
<meta name="twitter:label2" content="Reading time">
<meta name="twitter:data2" content="5 min read">
<meta property="og:url" content="https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL">
<meta property="og:title" content="Query Excel or CSV files with T-SQL">
<meta property="og:description" content="Query Excel or CSV files with T-SQL without importing them in a table first">


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL"
   },
  "name": "Query Excel or CSV files with T-SQL",
  "headline": "Query Excel or CSV files with T-SQL",
  "url": "https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL",
  "discussionUrl": "https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL#_comments",
  "isFamilyFriendly": "true",
  "image": "https://www.codeproject.com/App_Themes/CodeProject/Img/Article100.png",
  "keywords": "SQL,SQL-Server,Intermediate,CSV,SSMS,ini",
  "commentCount": "0",
  "editor" : {
    "@type" : "Person",
    "name" : "Editor",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=3865041"
  },
  "license": "http://www.codeproject.com/info/cpol10.aspx",
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "This article is a tutorial on how to query Excel or CSV files through T-SQL without first importing them into a table.",
  "articleSection": "SQL-Server",
  "author" : [{
      "@type" : "Person",
      "name" : "Federico Di Marco",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=3865041"
    }],
  "datePublished": "2023-10-23",
  "dateCreated": "2023-10-23",
  "dateModified": "2024-06-19"
,
  "contentRating" : {
    "@type" : "Rating",
    "ratingValue" : 4.70,
    "bestRating" : 5,
    "worstRating" : 1
  }
}</script>

<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=database",
      "name" : "database"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=SQL-Server",
      "name" : "SQL-Server"
    }
  }]
}</script>


	<!--<base target="_top">--><base href="." target="_top">
	
    


<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="./Query Excel or CSV files with T-SQL- CodeProject_files/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-1735123-1' , {'user_id': '61732e5b-06af-4ac2-8734-b1591748583e'});
    </script>

<style type="text/css"></style></head>	

<body class="chrome chrome130">



<a class="access-link" href="https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL#Main"><img alt="Click here to Skip to main content" src="./Query Excel or CSV files with T-SQL- CodeProject_files/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed narrow">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">65,938 articles</div>
	
	<div id="ctl00_MemberBar_ChangeNotice" class="flex-item align-left">CodeProject
	is changing. <a href="https://www.codeproject.com/info/Changes.aspx">Read more</a>.</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed narrow">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="./Query Excel or CSV files with T-SQL- CodeProject_files/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"></div>
        </div>
    </div>

	
			
	

	<div id="A" class="container-content-wrap fixed narrow"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=database">database</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=SQL-Server">SQL-Server</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL?display=Print" class="tooltip" title="">
   <img src="./Query Excel or CSV files with T-SQL- CodeProject_files/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    
            

			
			<div id="AT" class="article-container  fixed narrow" style="max-width:inherit;"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="https://www.codeproject.com/Tips/5370433/View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="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">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>
					    <a name="_articleTop" id="_articleTop"></a>

					    
						<div>
							<span id="ctl00_TagListHorz_TagWrp" class="tags horizontal">

	
	

	
	<span id="ctl00_TagListHorz_VisibleTags"><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/SQL" data-id="93">SQL</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/SQL-Server" data-id="101">SQL-Server</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/CSV" data-id="1211">CSV</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/SSMS" data-id="3431">SSMS</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/ini" data-id="5190">ini</a></div></span> 

	
	
</span>


						</div>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">Query Excel or CSV files with T-SQL</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3865041" rel="author">Federico Di Marco</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_5370433">

	<meta itemprop="upvoteCount" content="3">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		

		
		<div class="nowrap tooltip">

			
			<div id="ctl00_RateArticle_ResultNoHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:16px;" class="clipped"><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:8px;position:relative" class="clipped"><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/star-empty-lg.png" style="width:24px;height:24px;position:absolute;top:0px;right:0"></div></div></div>
			

			
			

			
            

			
                

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">4.70/5  (4 votes)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container" style="color:#666;font-size:smaller">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">19 Jun 2024</span><a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license flex-item-tight" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a><span id="ctl00_ReadingTime" class="stats flex-item-tight">5 min read</span><span id="ctl00_HorizontalStats" class="stats flex-item-tight"><span class="stats"><span title="Views"><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/views32.png" style="width:16px"> 15K</span> &nbsp; <span title="Downloads"><img src="./Query Excel or CSV files with T-SQL- CodeProject_files/download32.png" style="width:16px"> 215</span> &nbsp; </span></span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">Query Excel or CSV files with T-SQL without importing them in a table first</div><span id="ctl00_ThumbnailUrl" class="date" content="https://www.codeproject.com/script/Articles/Images/tip100x80.png"></span>			

                    </div>
                    
					
					

					

					
					<div id="ctl00_Abstract" class="abstract">This article is a tutorial on how to query Excel or CSV files through T-SQL without first importing them into a table.</div>

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<!-- Article Starts -->

<ul class="download">
	<li><a href="./Query Excel or CSV files with T-SQL- CodeProject_files/CSVExcel.zip">Download source code - 234.6 KB</a></li></ul>

<h2>Introduction</h2>

<p>Sometimes, it is useful to query Excel or CSV files using SQL statements without having to import them into a table through <code>BulkInsert</code>. This article shows in detail how and it uses Microsoft Access Database Engine which should be working on all editions of SQL Server since 2005.</p>

<h2>SQL Server Setup (must be done once)</h2>

<ul>
	<li>Enable <em>Ad Hoc Distributed Queries</em> in SSMS:

	<div class="pre-lang" id="premain102292"><div>SQL</div><div class="pre-action-link"><span id="copycode102292" class="copy-code" data-index="102292" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre102292" style="margin-top:0;" class="lang-sql notranslate" data-language="sql" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">sp_configure <span class="code-string">'</span><span class="code-string">show advanced options'</span>,<span class="code-digit">1</span>
<span class="code-keyword">reconfigure</span>
<span class="code-keyword">GO</span>
sp_configure <span class="code-string">'</span><span class="code-string">Ad Hoc Distributed Queries'</span>,<span class="code-digit">1</span>
<span class="code-keyword">reconfigure</span>
<span class="code-keyword">GO</span></pre>

	<ul>
		<li>Install <em>Microsoft Access Database Engine Redistributable</em> on server, the latest version I was able to find on Microsoft website is <a href="https://www.microsoft.com/en-us/download/details.aspx?id=54920">2016 (click here)</a></li>		<li>Enable <em>InProcess </em>and <em>DynamicParameters</em> for Microsoft Access Database Engine by entering in SSMS:</li>	</ul>

	<div class="pre-lang" id="premain545670"><div>SQL</div><div class="pre-action-link"><span id="copycode545670" class="copy-code" data-index="545670" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre545670" style="margin-top:0;" class="lang-sql notranslate" data-language="sql" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">USE</span> [master]
<span class="code-keyword">GO</span>
<span class="code-keyword">EXEC</span> master.dbo.sp_MSset_oledb_prop N<span class="code-string">'</span><span class="code-string">Microsoft.ACE.OLEDB.16.0'</span>, N<span class="code-string">'</span><span class="code-string">AllowInProcess'</span>, <span class="code-digit">1</span>
<span class="code-keyword">GO</span>
<span class="code-keyword">EXEC</span> master.dbo.sp_MSset_oledb_prop N<span class="code-string">'</span><span class="code-string">Microsoft.ACE.OLEDB.16.0'</span>, N<span class="code-string">'</span><span class="code-string">DynamicParameters'</span>, <span class="code-digit">1</span> 
<span class="code-keyword">GO</span></pre>
	</li>	<li>Restart SQL Server, after reconnecting with SSMS, you should see <strong>Microsoft..ACE.OLEDB.16.0</strong> under <em>Server Objects / Linked Servers / Providers.</em>
	<p><img height="962" src="./Query Excel or CSV files with T-SQL- CodeProject_files/LinkedServers_Provider_ACE_OLEDB.jpg" width="353" alt="Image 1"></p>
	</li></ul>

<h2>Using the Code</h2>

<p>In order to query an Excel or CSV file, you must first copy it to the SQL Server in a folder which is accessible with <strong>READ </strong>permission to the user account under which the SQL Server instance is running (you can know which account is by running <em>services.msc</em>, right click on <strong>SQL Server (MSSQLSERVER)</strong> -&gt; <strong>Properties</strong> -&gt; <strong>Log on tab</strong> -&gt; <strong>This account</strong>). If you are having issues, just for testing, you can copy it to a folder (e.g., <em>c:\temp</em>) and add in the security tab (right click on folder -&gt; <strong>Properties</strong> --&gt; <strong>Security</strong> tab) the <strong>EVERYONE </strong>user with READ access.</p>

<ul>
	<li><strong>How to query a CSV file (comma separated)</strong>: You can set the HDR parameter to YES if first row of CSV file contains the column names.

	<div class="pre-lang" id="premain519656"><div>SQL</div><div class="pre-action-link"><span id="copycode519656" class="copy-code" data-index="519656" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre519656" style="margin-top:0;" class="lang-sql notranslate" data-language="sql" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> <span class="code-keyword">OPENROWSET</span>(<span class="code-string">'</span><span class="code-string">Microsoft.ACE.OLEDB.16.0'</span>,_
   <span class="code-string">'</span><span class="code-string">Text;Database=&lt;path to file.csv&gt;;HDR=YES'</span>,<span class="code-string">'</span><span class="code-string">SELECT * FROM &lt;file.csv&gt;'</span>)</pre>
	</li>	<li><strong>How to query a CSV file (with a different separator than comma)</strong>: In this case, you have to create a <em>schema.ini</em> inside the same folder containing the CSV file with this content in order to specify the separator (you can specify different separators for different files, just repeat the 4 lines structure):
	<div class="pre-lang" id="premain298904"><div> </div><div class="pre-action-link"><span id="copycode298904" class="copy-code" data-index="298904" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre298904" style="margin-top:0;" data-language="text" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">[&lt;file.csv&gt;]
ColNameHeader=True
CharacterSet=ANSI
Format=Delimited(&lt;separator char&gt;)</pre>

	<p>The statement to query the CSV is the same as above, e.g.:</p>

	<div class="pre-lang" id="premain813824"><div>SQL</div><div class="pre-action-link"><span id="copycode813824" class="copy-code" data-index="813824" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre813824" style="margin-top:0;" class="lang-sql notranslate" data-language="sql" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> <span class="code-keyword">OPENROWSET</span>(<span class="code-string">'</span><span class="code-string">Microsoft.ACE.OLEDB.16.0'</span>,_
  <span class="code-string">'</span><span class="code-string">Text;Database=&lt;only directories to file.csv&gt;;HDR=YES'</span>,<span class="code-string">'</span><span class="code-string">SELECT * FROM &lt;file.csv&gt;'</span>)</pre>
	</li>	<li><strong>How to query an Excel file (.xlsx or .xls)</strong>: You have to use a different statement with the sheet name you want to query (usually, it's <code>Sheet1$</code> but pay attention that Excel is localized so it changes for different languages).
	<div class="pre-lang" id="premain450757"><div>SQL</div><div class="pre-action-link"><span id="copycode450757" class="copy-code" data-index="450757" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre450757" style="margin-top:0;" class="lang-sql notranslate" data-language="sql" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> <span class="code-keyword">OPENROWSET</span>(<span class="code-string">'</span><span class="code-string">Microsoft.ACE.OLEDB.16.0'</span>,<span class="code-string">'</span><span class="code-string">Excel 12.0; _
         Database=&lt;full path to excel.xlsx&gt;'</span>, [&lt;sheet name&gt;$])</pre>
	<img src="./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg" style="width: 700px; height: auto; cursor: pointer; border: 0" alt="Image 2" data-src="./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg" class="lazyautosizes lazyloaded" onclick="imageCleanup.showFullImage(&#39;./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg&#39;)" data-sizes="auto" data-srcset="./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg 400w, ./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg 700w, ./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg 2560w" sizes="700px" srcset="./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg 400w, ./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg 700w, ./Query Excel or CSV files with T-SQL- CodeProject_files/Querying_all_file_types.jpg 2560w"></li></ul>

<h2>Troubleshooting</h2>

<p>You could be experiencing some strange errors, usually most of them are about security issues. In order to troubleshoot them, we must understand that Microsoft.ACE.OLEDB.16.0 is a <strong>COM component</strong>. COM components are a core part of Windows operating system and they have been existing since its first editions (from Windows 95). Basically a COM component is a server object which exposes one or more functionalities through a set of interfaces accessible to every programming language (so to programs written in a different language than the one used to develop it, usually C/ C++. You may think that this feature nowadays is quite common but in the 90s, there was little interoperability). COM components are always registered in the Windows registry under <em>Computer\HKEY_CLASSES_ROOT\CLSID</em> when they are installed for the first time and have a <code>CLSID</code> (a guid) and a <code>PROGID</code> (a meaningful name, e.g., the Microsoft.ACE.OLEDB.16.0 above) for identifying and instancing them. A COM server can be "hosted" in three ways:</p>

<ul>
	<li><strong>In-Process</strong>: The COM server is usually a DLL which gets dynamically loaded and runs in the security context of the calling program. So when we configure the above In-Process option in SQL Server, the Microsoft.ACE.OLEDB.16.0 DLL gets loaded from SQL Server and runs

	<ul>
		<li>Under the user account of SQL Server, if you have connected to the server with SQL Server authentication</li>		<li>Under the user currently executing the above queries, if you have connected with Windows authentication.</li>	</ul>
	</li>	<li><strong>Out-Of-Process</strong>: The COM server is usually an external executable which is run automatically whenever you need to access the interfaces provided by the server. There is also the option to allow an In-Process DLL to run as an Out-Of-Process by using a standard system-provided surrogate EXE which hosts it (have you ever seen <em>dllhost.exe</em> in Task Manager :-) ?). The Out-Of-Process hosting can be done either on local computer or on a remote computer, in this case, we are talking about <strong>DCOM </strong>- Distributed COM.</li></ul>

<p>DCOM security permissions is quite complex and granular, in fact, we have:</p>

<ul>
	<li><strong>Launch Permissions</strong>: The users which are allowed to start FOR THE FIRST TIME the COM component.</li>	<li><strong>Access Permissions</strong>: The users which are allowed to access an already launched COM component (e.g., to use the method provided in its interfaces). So you may be allowed to access a COM component, but not to launch it (in this case, someone else has to launch it for you before you can access it).</li>	<li><strong>Configuration Permissions:</strong> The users which are allowed to change the DCOM configuration by using the command line tool <em>dcomcnfg.exe</em>.</li>	<li><strong>Identity (on the tab with the same name)</strong>: which specifies the user security context under which the COM component is run, it can be either the currently logged on (the interactive user), the user account of the client process that launched the server, a specified user, or a service.</li></ul>

<p>COM components security is configured by the running the commandline <em>dcomcnfg.exe</em>, if you go to <em>Component Services \ Computers\ My Computer \ DCOM Config</em> you should see all registered components, the one responsible for instantiating all the <em>OLEDB Linked Servers Providers</em> is <strong><em>MSDAINITIALIZE</em></strong>.</p>

<p><img alt="Image 3" src="./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png" data-src="./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png" class="lazyautosizes lazyloaded" style="cursor: pointer; border: 0; width: 700px; height: auto" onclick="imageCleanup.showFullImage(&#39;./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png&#39;)" data-sizes="auto" data-srcset="./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png 400w, ./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png 700w, ./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png 2553w" sizes="700px" srcset="./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png 400w, ./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png 700w, ./Query Excel or CSV files with T-SQL- CodeProject_files/extracted-image-1.png 2553w"></p>

<p>If you run the Microsoft.ACE.OLEDB.16.0 with <strong>In-Process</strong> hosting, you should be able to solve most of the security issues by <em>launching SSMS as an administrator</em>. If you instead prefer (or need) to host it with <strong>Out-Of-Process</strong> hosting, you can check <a href="https://techcommunity.microsoft.com/t5/sql-server-support-blog/permissions-needed-to-set-up-linked-server-with-out-of-process/ba-p/316196">this Microsoft Tech Community article</a> which should explain how to solve most of the issues by tweaking DCOM configuration. Also, this <a href="https://stackoverflow.com/questions/26267224/the-ole-db-provider-microsoft-ace-oledb-12-0-for-linked-server-null">post on StackOverflow</a> has some good information on how to solve the most common issues.</p>

<h2>Points of Interest</h2>

<p>I attach the sample Excel / CSV / <em>schema.ini</em> files I have used to test the above code. You can find the source code on <a href="https://github.com/fededim/TSqlResources/blob/master/TSqlResources/Scripts/QueryExcelCsv.sql">my GitHub repository TSqlResources</a>.</p>

<h2>History</h2>

<ul>
	<li>V1.0 (22<sup>nd</sup>&nbsp;October, 2023)

	<ul>
		<li>Initial version</li>	</ul>
	</li>	<li>V1.1 (3<sup>rd</sup> November, 2023)
	<ul>
		<li>Added troubleshooting section with a brief explanation of COM</li>	</ul>
	</li></ul>




						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" rel="license">The Code Project Open License (CPOL)</a></p></div>
						

						
						<br>
						
						    <br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    
				</div>
				
                
                

				
				
				

			</div>
			

            
            
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL">Permalink</a><br>
				<br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Tips/5370433/Query-Excel-or-CSV-files-with-T-SQL?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2023 by Federico Di Marco<br>Everything else
				Copyright Â© <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2024<br>
                <br>
				Web01 
				2.8:2024-10-19:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>







<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas></body></html>